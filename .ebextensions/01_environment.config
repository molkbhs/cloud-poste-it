option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeVersion: 18.17.0
    InstanceType: t3.micro
    ProxyServer: nginx
    GzipCompression: true

  # Environment properties
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 8081

  # Auto scaling
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 3
    Cooldown: 300

  aws:autoscaling:trigger:
    MeasureName: CPUUtilization
    Statistic: Average
    Unit: Percent
    UpperThreshold: 70
    LowerThreshold: 30

  # Load balancer
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckInterval: 30
    HealthCheckPath: /health
    HealthCheckTimeout: 5
    HealthyThresholdCount: 3
    UnhealthyThresholdCount: 5
    Port: 8081
    Protocol: HTTP

  # Logging
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7

  # Enhanced health reporting
  aws:elasticbeanstalk:environment:
    EnhancedHealthAuthEnabled: true
    EnvironmentType: LoadBalanced
    LoadBalancerType: application
    ServiceRole: aws-elasticbeanstalk-service-role
    EC2KeyName: postit-app-key
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
