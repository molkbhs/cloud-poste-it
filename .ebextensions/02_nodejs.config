files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/01-app.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/nodejs/nodejs.log

commands:
  01_npm_install:
    command: "npm ci --production"
    cwd: /var/app/current
    leader_only: true

  02_npm_build:
    command: "npm run build --prefix frontend"
    cwd: /var/app/current
    leader_only: true
    ignoreErrors: true

  03_copy_frontend:
    command: "cp -r /var/app/current/frontend/build /var/app/current/backend/public || true"
    leader_only: true
    ignoreErrors: true

container_commands:
  01_main:
    command: "npm start --prefix backend"
    leader_only: false
